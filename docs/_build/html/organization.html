

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Organization &mdash; EpyNN 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> EpyNN
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="epynn.html">EpyNN Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Template.html">Template layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Embedding.html">Data Embedding (Input)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dense.html">Fully Connected (Dense)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RNN.html">Recurrent Neural Network (RNN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="LSTM.html">Long Short-Term Memory (LSTM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="GRU.html">Gated Recurrent Unit (GRU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Convolution.html">Convolutional Neural Network (CNN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Dropout.html">Dropout</a></li>
<li class="toctree-l1"><a class="reference internal" href="Flatten.html">Flatten</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Examples and data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Details.html">Details</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">EpyNN</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Organization</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/organization.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="organization">
<h1>Organization<a class="headerlink" href="#organization" title="Permalink to this headline">¶</a></h1>
<div class="section" id="guidelines">
<h2>Guidelines<a class="headerlink" href="#guidelines" title="Permalink to this headline">¶</a></h2>
<p>Although EpyNN can be used for production, it is meant to be a library of homogeneous architecture templates and practical examples which is expected to save an important amount of time for people who wish to learn, teach or develop from scratch, by themselves.</p>
<div class="section" id="pure-python-numpy">
<h3>Pure Python/NumPy<a class="headerlink" href="#pure-python-numpy" title="Permalink to this headline">¶</a></h3>
<p>EpyNN in written in pure Python/NumPy without a single import from AI librairies.</p>
<p>By focusing on readability, the source code of EpyNN thus directly reflects the mathematics underlying the diverse architectures provided with EpyNN.</p>
</div>
<div class="section" id="functions-over-class-methods">
<h3>Functions over Class Methods<a class="headerlink" href="#functions-over-class-methods" title="Permalink to this headline">¶</a></h3>
<p>Although Python is well suited - if not designed - for extensive use of Class and Method attributes, we choose to favor Functions as much as possible, consistently with directory structures.</p>
</div>
<div class="section" id="less-intricate-code">
<h3>Less intricate code<a class="headerlink" href="#less-intricate-code" title="Permalink to this headline">¶</a></h3>
<p>The root <code class="docutils literal notranslate"><span class="pre">EpyNN/</span></code> directory contains the <code class="docutils literal notranslate"><span class="pre">nnlibs</span></code> sub-directory which includes commons, the EpyNN meta-model, and each layer architectures used to build Neural Networks.</p>
<p>Consequently, a single level of recursion from <code class="docutils literal notranslate"><span class="pre">EpyNN/nnlibs</span></code> is required to explore all content and associated python sources.</p>
</div>
</div>
<div class="section" id="layers">
<h2>Layers<a class="headerlink" href="#layers" title="Permalink to this headline">¶</a></h2>
<p>Neural Networks are made of architecture layers, implemented in EpyNN as <strong>models</strong>.</p>
<p>A single layer contains nodes - often refereed to as neurons - and architecture-specific <strong>forward</strong> and <strong>backward</strong> schemes for <em>signal</em> and <em>error</em> propagation, respectively.</p>
<p>Whereas a forward-propagated signal yields a result, a backward-propagated error enables the Neural Network to learn by computing <em>gradients</em> used to alter architecture-specific <strong>parameters</strong>.</p>
<div class="section" id="models">
<h3>models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h3>
<p>Each layer directory contains a <code class="docutils literal notranslate"><span class="pre">models.py</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/template/parameters.py</span>
<span class="c1"># Local application/library specific imports</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.models</span> <span class="kn">import</span> <span class="n">Layer</span>
<span class="kn">from</span> <span class="nn">nnlibs.template.forward</span> <span class="kn">import</span> <span class="n">template_forward</span>
<span class="kn">from</span> <span class="nn">nnlibs.template.backward</span> <span class="kn">import</span> <span class="n">template_backward</span>
<span class="kn">from</span> <span class="nn">nnlibs.template.parameters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">template_compute_shapes</span><span class="p">,</span>
    <span class="n">template_initialize_parameters</span><span class="p">,</span>
    <span class="n">template_compute_gradients</span><span class="p">,</span>
    <span class="n">template_update_parameters</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Template</span><span class="p">(</span><span class="n">Layer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Definition of a template layer prototype. This is a pass-through or inactive layer prototype which contains method definitions used for all active layers. For all layer prototypes, methods are wrappers of functions which contain the specific implementations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize instance variable attributes. Extended with ``super().__init__()`` which calls ``nnlibs.commons.models.Layer.__init__()`` defined in the parent class.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute **shapes** and set dependent **dimensions**. Is a wrapper for ``nnlibs.template.parameters.template_compute_shapes()``.</span>

<span class="sd">        :param A: Output of forward propagation from *previous* layer.</span>
<span class="sd">        :type A: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">template_compute_shapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize **weight** and **bias** parameters from shapes. Is a wrapper for ``nnlibs.template.parameters.template_initialize_parameters()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">template_initialize_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Forward propagation of signal through **current** layer. Is a wrapper for ``nnlibs.template.forward.template_forward()``.</span>

<span class="sd">        :param A: Output of forward propagation from *previous* layer.</span>
<span class="sd">        :type A: :class:`numpy.ndarray`</span>

<span class="sd">        :return: Output from **current** layer.</span>
<span class="sd">        :rtype: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compute_shapes</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">template_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shapes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">A</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dA</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Backward propagation of error through **current** layer. Is a wrapper for ``nnlibs.template.backward.template_backward()``.</span>

<span class="sd">        :param dA: Output of backward propagation from *next* layer.</span>
<span class="sd">        :type dA: :class:`numpy.ndarray`</span>

<span class="sd">        :return: Output of backward propagation from **current** layer.</span>
<span class="sd">        :rtype: :class:`numpy.ndarray`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dA</span> <span class="o">=</span> <span class="n">template_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dA</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_shapes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dA</span>

    <span class="k">def</span> <span class="nf">compute_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute **gradients** with respect to **weight** and **bias** parameters for current layer. Is a wrapper for ``nnlibs.template.parameters.template_compute_gradients()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">template_compute_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update **weight** and **bias** parameters with respect to **gradients** for current layer. Is a wrapper for ``nnlibs.template.parameters.template_update_parameters()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">template_update_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="forward">
<h3>forward<a class="headerlink" href="#forward" title="Permalink to this headline">¶</a></h3>
<p>Each layer directory contains a <code class="docutils literal notranslate"><span class="pre">forward.py</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#EpyNN/nnlibs/template/forward.py</span>


<span class="k">def</span> <span class="nf">template_forward</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">initialize_forward</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">A</span>


<span class="k">def</span> <span class="nf">initialize_forward</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">fc</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>

    <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
<div class="section" id="backward">
<h3>backward<a class="headerlink" href="#backward" title="Permalink to this headline">¶</a></h3>
<p>Each layer directory contains a <code class="docutils literal notranslate"><span class="pre">backward.py</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/template/backward.py</span>


<span class="k">def</span> <span class="nf">template_backward</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">dA</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param layer: An instance of the :class:`nnlibs.template.models.Template`</span>
<span class="sd">    :type layer: class:`nnlibs.template.models.Template`</span>

<span class="sd">    :param dA:</span>
<span class="sd">    :type dA: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dX</span> <span class="o">=</span> <span class="n">initialize_backward</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">dA</span><span class="p">)</span>

    <span class="n">dA</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">bc</span><span class="p">[</span><span class="s1">&#39;dA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dX</span>

    <span class="k">return</span> <span class="n">dA</span>


<span class="k">def</span> <span class="nf">initialize_backward</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">dA</span><span class="p">):</span>

    <span class="n">dX</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">bc</span><span class="p">[</span><span class="s1">&#39;dX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dA</span>

    <span class="k">return</span> <span class="n">dX</span>
</pre></div>
</div>
</div>
<div class="section" id="parameters">
<h3>parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>Each layer directory contains a <code class="docutils literal notranslate"><span class="pre">parameters.py</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/template/parameters.py</span>


<span class="k">def</span> <span class="nf">template_compute_shapes</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute shapes for Template layer object</span>

<span class="sd">    :param layer: An instance of the :class:`nnlibs.template.models.Template`</span>
<span class="sd">    :type layer: class:`nnlibs.template.models.Template`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">A</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">template_initialize_parameters</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dummy function - Initialize parameters for Template layer object</span>

<span class="sd">    :param layer: An instance of the :class:`nnlibs.template.models.Template`</span>
<span class="sd">    :type layer: class:`nnlibs.template.models.Template`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># No parameters to initialize for Template layer</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">template_compute_gradients</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dummy function - Update weight and bias gradients for Template layer object</span>

<span class="sd">    :param layer: An instance of the :class:`nnlibs.template.models.Template`</span>
<span class="sd">    :type layer: class:`nnlibs.template.models.Template`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># No gradients to update for Template layer</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">template_update_parameters</span><span class="p">(</span><span class="n">layer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dummy function - Update parameters for Template layer object</span>

<span class="sd">    :param layer: An instance of the :class:`nnlibs.template.models.Template`</span>
<span class="sd">    :type layer: class:`nnlibs.template.models.Template`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># No parameters to update for Template layer</span>

    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="meta">
<h2>Meta<a class="headerlink" href="#meta" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>models<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/meta/models.py</span>
<span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Local application/library specific imports</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.models</span> <span class="kn">import</span> <span class="n">dataSet</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.io</span> <span class="kn">import</span> <span class="n">encode_dataset</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.metrics</span> <span class="kn">import</span> <span class="n">model_compute_metrics</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.library</span> <span class="kn">import</span> <span class="n">write_model</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.logs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">model_logs</span><span class="p">,</span>
    <span class="n">initialize_model_logs</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.plot</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">pyplot_metrics</span><span class="p">,</span>
    <span class="n">gnuplot_accuracy</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">nnlibs.meta.initialize</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">initialize_model_layers</span><span class="p">,</span>
    <span class="n">initialize_exceptions</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">nnlibs.meta.parameters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">assign_seed_layers</span><span class="p">,</span>
    <span class="n">compute_learning_rate</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">nnlibs.meta.forward</span> <span class="kn">import</span> <span class="n">model_forward</span>
<span class="kn">from</span> <span class="nn">nnlibs.meta.backward</span> <span class="kn">import</span> <span class="n">model_backward</span>
<span class="kn">from</span> <span class="nn">nnlibs.meta.training</span> <span class="kn">import</span> <span class="n">model_training</span>
<span class="kn">from</span> <span class="nn">nnlibs.settings</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">dataset</span> <span class="k">as</span> <span class="n">se_dataset</span><span class="p">,</span>
    <span class="n">config</span> <span class="k">as</span> <span class="n">se_config</span><span class="p">,</span>
    <span class="n">hPars</span> <span class="k">as</span> <span class="n">se_hPars</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">EpyNN</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Definition of an . prototype.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">layers</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">settings</span><span class="o">=</span><span class="p">[</span><span class="n">se_dataset</span><span class="p">,</span> <span class="n">se_config</span><span class="p">,</span> <span class="n">se_hPars</span><span class="p">],</span>
                <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Model&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :ivar ts:</span>
<span class="sd">        :vartype ts:</span>
<span class="sd">        :ivar layers:</span>
<span class="sd">        :vartype layers:</span>
<span class="sd">        :ivar embedding:</span>
<span class="sd">        :vartype embedding:</span>
<span class="sd">        :ivar se_dataset:</span>
<span class="sd">        :vartype se_dataset:</span>
<span class="sd">        :ivar se_config:</span>
<span class="sd">        :vartype se_config:</span>
<span class="sd">        :ivar se_hPars:</span>
<span class="sd">        :vartype se_hPars:</span>
<span class="sd">        :ivar epochs:</span>
<span class="sd">        :vartype epochs:</span>
<span class="sd">        :ivar seed:</span>
<span class="sd">        :vartype seed:</span>
<span class="sd">        :ivar name:</span>
<span class="sd">        :vartype name:</span>
<span class="sd">        :ivar uname:</span>
<span class="sd">        :vartype uname:</span>
<span class="sd">        :ivar network:</span>
<span class="sd">        :vartype network:</span>
<span class="sd">        :ivar metrics:</span>
<span class="sd">        :vartype metrics:</span>
<span class="sd">        :ivar saved:</span>
<span class="sd">        :vartype saved:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">se_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">se_config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">se_hPars</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">layer</span><span class="p">):{}</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;training_epochs&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:[[]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">se_config</span><span class="p">[</span><span class="s1">&#39;metrics_list&#39;</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saved</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param A:</span>
<span class="sd">        :type A:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">model_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">A</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dA</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param dA:</span>
<span class="sd">        :type dA:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dA</span> <span class="o">=</span> <span class="n">model_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dA</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dA</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assign_seed_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">compute_learning_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">initialize_model_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">initialize_exceptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">trace</span><span class="p">)</span>

        <span class="n">initialize_model_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param init:</span>
<span class="sd">        :type init:</span>
<span class="sd">        :param run:</span>
<span class="sd">        :type run:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">model_training</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">compute_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_compute_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param write:</span>
<span class="sd">        :type write:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
            <span class="n">write_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gnuplot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param pyplot:</span>
<span class="sd">        :type pyplot:</span>
<span class="sd">        :param gnuplot:</span>
<span class="sd">        :type gnuplot:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pyplot</span><span class="p">:</span>
            <span class="n">pyplot_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gnuplot</span><span class="p">:</span>
            <span class="n">gnuplot_accuracy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param dataset:</span>
<span class="sd">        :type dataset:</span>
<span class="sd">        :param encode:</span>
<span class="sd">        :type encode:</span>
<span class="sd">        :return:</span>
<span class="sd">        :rtype:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">encode</span><span class="p">:</span>
            <span class="n">word_to_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">w2i</span>
            <span class="n">vocab_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">encode_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">word_to_idx</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span>

        <span class="n">dset</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">X</span>

        <span class="n">dset</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">return</span> <span class="n">dset</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>forward<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/meta/forward.py</span>


<span class="k">def</span> <span class="nf">model_forward</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">    :param A:</span>
<span class="sd">    :type A:</span>
<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>

        <span class="n">layer</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">e</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">A</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>backward<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/meta/backward.py</span>


<span class="k">def</span> <span class="nf">model_backward</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dA</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">    :param A:</span>
<span class="sd">    :type A:</span>
<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>

        <span class="n">dA</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">dA</span><span class="p">)</span>

        <span class="n">layer</span><span class="o">.</span><span class="n">compute_gradients</span><span class="p">()</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>parameters<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/meta/parameters.py</span>
<span class="c1"># Related third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Local application/library specific imports</span>
<span class="kn">from</span> <span class="nn">nnlibs.commons.schedule</span> <span class="kn">import</span> <span class="n">schedulers</span>


<span class="k">def</span> <span class="nf">assign_seed_layers</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">seed</span>

    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">seed</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
            <span class="n">seed</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">layer</span><span class="o">.</span><span class="n">np_rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">layer</span><span class="o">.</span><span class="n">o</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">compute_learning_rate</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">se_hPars</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">se_hPars</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">se_hPars</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">se_hPars</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">se_hPars</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">se_hPars</span>

        <span class="n">layer</span><span class="o">.</span><span class="n">se_hPars</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">lrate</span> <span class="o">=</span> <span class="n">schedulers</span><span class="p">(</span><span class="n">se_hPars</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="train">
<h3>train<a class="headerlink" href="#train" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="commons">
<h2>Commons<a class="headerlink" href="#commons" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decorators">
<h3>decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="io">
<h3>io<a class="headerlink" href="#io" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/commons/io.py</span>
<span class="c1"># Related third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">one_hot_encode</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">    :param i:</span>
<span class="sd">    :type i:</span>

<span class="sd">    :param vocab_size:</span>
<span class="sd">    :type vocab_size:</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">one_hot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">vocab_size</span><span class="p">)</span>

    <span class="n">one_hot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">one_hot</span>


<span class="k">def</span> <span class="nf">one_hot_encode_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">word_to_idx</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">    :param sequence:</span>
<span class="sd">    :type sequence:</span>

<span class="sd">    :param word_to_idx:</span>
<span class="sd">    :type word_to_idx:</span>

<span class="sd">    :param vocab_size:</span>
<span class="sd">    :type vocab_size:</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">encoding</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">one_hot_encode</span><span class="p">(</span><span class="n">word_to_idx</span><span class="p">[</span><span class="n">word</span><span class="p">],</span> <span class="n">vocab_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">])</span>

    <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">encoding</span>


<span class="k">def</span> <span class="nf">one_hot_decode_sequence</span><span class="p">(</span><span class="n">sequence</span><span class="p">,</span> <span class="n">idx_to_word</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">    :param sequence:</span>
<span class="sd">    :type sequence:</span>

<span class="sd">    :param idx_to_word:</span>
<span class="sd">    :type idx_to_word:</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">decoding</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx_to_word</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">encoded</span><span class="p">)]</span> <span class="k">for</span> <span class="n">encoded</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">decoding</span>


<span class="k">def</span> <span class="nf">encode_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">word_to_idx</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">    :param dataset:</span>
<span class="sd">    :type dataset:</span>

<span class="sd">    :param word_to_idx:</span>
<span class="sd">    :type word_to_idx:</span>

<span class="sd">    :param vocab_size:</span>
<span class="sd">    :type vocab_size:</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">encoded_dataset</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)):</span>

        <span class="n">features</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">encoded_features</span> <span class="o">=</span> <span class="n">one_hot_encode_sequence</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">word_to_idx</span><span class="p">,</span> <span class="n">vocab_size</span><span class="p">)</span>

        <span class="n">sample</span> <span class="o">=</span> <span class="p">[</span><span class="n">encoded_features</span><span class="p">,</span><span class="n">label</span><span class="p">]</span>

        <span class="n">encoded_dataset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">encoded_dataset</span>
</pre></div>
</div>
</div>
<div class="section" id="library">
<h3>library<a class="headerlink" href="#library" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="logs">
<h3>logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="maths">
<h3>maths<a class="headerlink" href="#maths" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/commons/maths.py</span>
<span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Related third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p><strong>Weights initialization</strong></p>
<ul class="simple">
<li><p>Xavier</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">xavier</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Orthogonal</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">orthogonal</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="p">):</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># Compute QR factorization</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">qr</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># Make Q uniform according to https://arxiv.org/pdf/math-ph/0609050.pdf</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">*=</span> <span class="n">ph</span>

    <span class="k">if</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">T</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">q</span>

    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
<p><strong>Activation functions and derivatives</strong></p>
<p><em>Rectifier Linear Unit (ReLU)</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute ReLU activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
<p><em>Leaky ReLu (LReLU)</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lrelu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute LReLU activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">CST</span><span class="p">[</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
<p><em>Exponential Linear Unit (ELU)</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">elu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute ELU activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">CST</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">elu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
<p><em>Sigmoid</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute Sigmoid activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># condition</span>
                    <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)),</span> <span class="c1"># For positive values</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="c1"># For negative values</span>
                    <span class="p">)</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
<p><em>Hyperbolic tangent (tanh)</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute tanh activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
<p><em>Swish</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swish</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute Swish activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
<p><em>Softmax</em></p>
<ul class="simple">
<li><p>Primary</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute softmax activation or derivative</span>

<span class="sd">    :param x:</span>
<span class="sd">    :type x: class:`numpy.ndarray`</span>

<span class="sd">    :param deriv:</span>
<span class="sd">    :type deriv: bool</span>

<span class="sd">    :return:</span>
<span class="sd">    :rtype: class:`numpy.ndarray`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#T = CST[&#39;s&#39;]</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">x_</span>

    <span class="k">elif</span> <span class="n">deriv</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Derivative</p></li>
</ul>
</div>
<div class="section" id="metrics">
<h3>metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="id5">
<h3>models<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/commons/models.py</span>
<span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Related third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">Layer</span><span class="p">:</span>
    <span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">dataSet</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Definition of a dataSet object prototype</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dummy&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;.</span>

<span class="sd">        :param dataset: .</span>
<span class="sd">        :type dataset: list</span>

<span class="sd">        :param label: .</span>
<span class="sd">        :type label: bool</span>

<span class="sd">        :param name: .</span>
<span class="sd">        :type name: string</span>

<span class="sd">        :ivar n:</span>
<span class="sd">        :vartype n:</span>

<span class="sd">        :ivar X:</span>
<span class="sd">        :vartype X:</span>

<span class="sd">        :ivar Y:</span>
<span class="sd">        :vartype Y:</span>

<span class="sd">        :ivar y:</span>
<span class="sd">        :vartype y:</span>

<span class="sd">        :ivar b:</span>
<span class="sd">        :vartype b:</span>

<span class="sd">        :ivar id:</span>
<span class="sd">        :vartype id:</span>

<span class="sd">        :ivar s:</span>
<span class="sd">        :vartype s:</span>

<span class="sd">        :ivar A:</span>
<span class="sd">        :vartype A:</span>

<span class="sd">        :ivar P:</span>
<span class="sd">        :vartype P:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_data</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="p">]</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Labels balance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">}</span>

        <span class="c1"># Set numerical id for each sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span> <span class="p">])</span>

        <span class="c1"># Number of samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="plot">
<h3>plot<a class="headerlink" href="#plot" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="schedule">
<h3>schedule<a class="headerlink" href="#schedule" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># EpyNN/nnlibs/commons/schedule.py</span>
<span class="c1"># Related third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">exp_decay</span><span class="p">(</span><span class="n">hPars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">epc</span> <span class="o">=</span> <span class="n">hPars</span>

    <span class="k">return</span> <span class="p">[</span> <span class="n">lr</span> <span class="o">*</span> <span class="n">d</span><span class="o">**</span><span class="p">(</span><span class="n">x</span><span class="o">//</span><span class="n">epc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="n">epc</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">]</span>


<span class="k">def</span> <span class="nf">lin_decay</span><span class="p">(</span><span class="n">hPars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">epc</span> <span class="o">=</span> <span class="n">hPars</span>

    <span class="k">return</span> <span class="p">[</span> <span class="n">lr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">]</span>


<span class="k">def</span> <span class="nf">steady</span><span class="p">(</span><span class="n">hPars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">epc</span> <span class="o">=</span> <span class="n">hPars</span>

    <span class="k">return</span> <span class="p">[</span> <span class="n">lr</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">]</span>


<span class="k">def</span> <span class="nf">schedulers</span><span class="p">(</span><span class="n">se_hPars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;training_epochs&#39;</span><span class="p">]</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;cycling_n&#39;</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;descent_d&#39;</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;decay_k&#39;</span><span class="p">]</span>

    <span class="n">epc</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;epochs_per_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span> <span class="o">//</span> <span class="n">n</span>

    <span class="c1"># Default decay</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># 0.005% of initial lr for last epoch in cycle</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;decay_k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">epc</span>


    <span class="n">schedulers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;steady&#39;</span><span class="p">:</span> <span class="n">steady</span><span class="p">,</span>
    <span class="s1">&#39;exp_decay&#39;</span><span class="p">:</span> <span class="n">exp_decay</span><span class="p">,</span>
    <span class="s1">&#39;lin_decay&#39;</span><span class="p">:</span> <span class="n">lin_decay</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">hPars</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">lr</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">epc</span><span class="p">)</span>

    <span class="n">lrate</span> <span class="o">=</span> <span class="n">schedulers</span><span class="p">[</span><span class="n">se_hPars</span><span class="p">[</span><span class="s1">&#39;schedule_mode&#39;</span><span class="p">]](</span><span class="n">hPars</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">se_hPars</span><span class="p">,</span> <span class="n">lrate</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Florian Malard and Stéphanie Olivier-Van Stichelen.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>